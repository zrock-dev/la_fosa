[gd_scene load_steps=5 format=2]

[ext_resource path="res://assets/button/big-joystick.png" type="Texture" id=1]
[ext_resource path="res://assets/button/joystick.png" type="Texture" id=2]

[sub_resource type="GDScript" id=1]
script/source = "extends CanvasLayer

signal move_signal
var move_vector = Vector2(0,0)
var joystick_active = false

func _input(event):
	if event is InputEventScreenTouch or event is InputEventScreenDrag:
		
		if $TouchScreenButton.is_pressed():
			move_vector = calculate_move_vector(event.position)
			joystick_active = true
			$InnerCircle.position = event.position
			$InnerCircle.visible = true
			
	if event is InputEventScreenTouch and event.pressed == false:
			joystick_active = false
			$InnerCircle.visible = false

func _physics_process(delta):
	if joystick_active:
		emit_signal(\"move_signal\", move_vector)

func calculate_move_vector(event_position):
	var texture_center = $TouchScreenButton.position + Vector2(90,90)
	print(texture_center - event_position)
	return (event_position - texture_center).normalized()
"

[sub_resource type="CircleShape2D" id=2]
radius = 450.0

[node name="CanvasLayer" type="CanvasLayer"]
script = SubResource( 1 )

[node name="TouchScreenButton" type="TouchScreenButton" parent="."]
position = Vector2( 21, 393 )
scale = Vector2( 0.198653, 0.2 )
z_index = 1
normal = ExtResource( 1 )
shape = SubResource( 2 )

[node name="InnerCircle" type="Sprite" parent="."]
visible = false
position = Vector2( 241, 424 )
scale = Vector2( 0.488889, 0.488889 )
z_index = 2
texture = ExtResource( 2 )
